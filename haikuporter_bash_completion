# Simple bash completion rules for the haikuporter script
#
# To install: copy this file to the /etc/bash_completion.d directory
#
# Note: To increase speed, the list of packages is created when the shell starts
# This means it won't notice changes to the ports tree until you restart the
# shell or source this script again with a command like:
# '. /etc/bash_completion.d/haikuporter_bash_completion'


HAIKUPORTS_PATH=$(haikuporter -t)

for i in "${HAIKUPORTS_PATH}"/*/*/*.bep; do
	i="${i##*/}"
	HAIKUPORTS_PACKAGES="${i%.bep} ${HAIKUPORTS_PACKAGES}"
done

function _haikuporter()
{
	local cur=${COMP_WORDS[COMP_CWORD]}

	# Stop offering completions when one of these is in the previous argument.
	case ${COMP_WORDS[COMP_CWORD-1]} in
		--version|-h|--help|-s|--search|-l|--list|-g|--get|-t|--tree)
			return 0
			;;
	esac

	if [[ ${cur} == -* ]];then
		COMPREPLY=( $(compgen -W '--version -h --help -l --list -a --about -s --search -p --nopatch -b --nobuild -i --install -d --distro -c --clean -g --get -f --force -z --archive -t --tree -y --yes' -- ${cur}) )
		return 0
	fi

	COMPREPLY=( $(compgen -W '${HAIKUPORTS_PACKAGES}' -- ${cur}) )

	return 0
}
complete -F _haikuporter -o filenames haikuporter
